<!DOCTYPE html>
<html>
  <head>
    <title>Abcd</title>
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  </head>

  <body>
    <iframe id="destination-frame" src="http://2395db1e.ngrok.io">
    </iframe>
    <script type="text/javascript">
      $(document).ready(function() {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-115156230-1', 'auto');
        // This pageview works if sent and will show that it is coming from facebook
        ga('send', 'pageview')
        ga(function(tracker) {
          // Gets the client ID of the default tracker.
          var clientId = tracker.get('clientId');
          console.log(1)
          setTimeout(function(){
            console.log(3)
            // Gets a reference to the window object of the destionation iframe.
            var frameWindow = document.getElementById('destination-frame').contentWindow;

            // Sends the client ID to the window inside the destination frame.
            frameWindow.postMessage(clientId, 'http://2395db1e.ngrok.io');
          }, 10000);

        });
      })
    </script>
  </body>
</html>
